<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>RVI + ROI Viewer</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet GeoTIFF -->
<script src="https://unpkg.com/georaster/dist/georaster.browserify.min.js"></script>
<script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
<script src="https://unpkg.com/plotty/build/plotty.min.js"></script>

<style>
  html, body { margin:0; height:100%; }
  #map { width:100%; height:100%; }
</style>
</head>
<body>

<div id="map"></div>

<script>
/*******************************************************
   1. BASEMAP + MAP + LAYER CONTROL
*******************************************************/
const map = L.map("map", { center: [10.49, -85.50], zoom: 11 });

const satellite = L.tileLayer(
  "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
  { attribution: "Esri Satellite" }
).addTo(map);

let rviLayer = null;
let roiLayer = null;

const layerControl = L.control.layers(
  { "Satellite": satellite },
  {},
  { collapsed: false }
).addTo(map);


/*******************************************************
   2. ROI POLYGON
*******************************************************/
const roiCoords = [
  [10.543880176744038, -85.59765362456451],
  [10.419983389530952, -85.59765362456451],
  [10.419983389530952, -85.40676617339264],
  [10.543880176744038, -85.40676617339264]
];

roiLayer = L.polygon(roiCoords, {
  color: "red",
  weight: 2,
  fillOpacity: 0.1
}).addTo(map);

layerControl.addOverlay(roiLayer, "ROI");


/*******************************************************
   3. LOAD TIFF "Mean_RVI_2025.tif" FROM GITHUB
*******************************************************/

// RAW GitHub URL:
const rviUrl =
  "https://raw.githubusercontent.com/palfangulo/WebGISMapping/main/maps/RVI/Mean_RVI_2025.tif";

// Load TIFF
fetch(rviUrl)
  .then(r => r.arrayBuffer())
  .then(buffer => georaster = parseGeoraster(buffer))
  .then(georaster => {

    // Color scale for RVI
    const rviOptions = {
      pixelValuesToColorFn: function(value) {
        return plotty.colorScaleToColor("viridis", value, 0, 1);
      },
      resolution: 256,
      opacity: 0.85
    };

    rviLayer = new GeoRasterLayer({
      georaster: georaster,
      ...rviOptions
    });

    rviLayer.addTo(map);
    layerControl.addOverlay(rviLayer, "RVI");

    map.fitBounds(rviLayer.getBounds());
  })
  .catch(err => console.error("TIFF load error:", err));

</script>

</body>
</html>
