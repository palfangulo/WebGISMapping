<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Costa Rica â€“ Canopy Height WebGIS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    .legend {
      background: white;
      padding: 10px;
      font-size: 12px;
      line-height: 18px;
      box-shadow: 0 0 15px rgba(0,0,0,0.25);
    }

    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // ====================================================
  // MAP INITIALIZATION
  // ====================================================
  var map = L.map('map', {
    minZoom: 6,
    maxZoom: 19
  }).setView([9.9, -84.0], 9);

  // ====================================================
  // BASEMAP
  // ====================================================
  var osm = L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    {
      attribution: '&copy; OpenStreetMap contributors',
      maxZoom: 19
    }
  ).addTo(map);

  // ====================================================
  // GEE CANOPY HEIGHT TILE LAYER
  // ====================================================
  var canopyHeight = L.tileLayer(
    'https://earthengine.googleapis.com/v1/projects/ee-palfangulo2/maps/f5da067e53f2ff90cb6c8c9032c12de8-86a0f2ed8374cef6494f48f1dd64fe4f/tiles/{z}/{x}/{y}',
    {
      attribution: 'Meta/WRI Canopy Height Â· ESA WorldCover Â· Google Earth Engine',
      maxZoom: 19,
      opacity: 0.85
    }
  );

  // ====================================================
  // GEOJSON: MANGROVE CANOPY HEIGHT CLASSES
  // ====================================================
  function mangroveStyle(feature) {
  return {
    fillColor:
      feature.properties.MH == 1 ? "#2c7bb6" :  // BLUE  (< 5 m)
      feature.properties.MH == 2 ? "#1a9641" :  // GREEN (5â€“10 m)
      feature.properties.MH == 3 ? "#ffff33" :  // YELLOW (10â€“20 m)
      "#d7191c",                                // RED (> 20 m)
    stroke: false,       // no outline
    fillOpacity: 1
  };
}




  function mangrovePopup(feature, layer) {
    const label =
      feature.properties.MH == 1 ? "< 5 m" :
      feature.properties.MH == 2 ? "5â€“10 m" :
      feature.properties.MH == 3 ? "10â€“20 m" :
      "> 20 m";

    layer.bindPopup(
      "<strong>Mangrove Canopy Height</strong><br>" + label
    );
  }

var mangroveLayer = L.geoJSON(null, {
  style: mangroveStyle,
  onEachFeature: mangrovePopup
}).addTo(map);   // ðŸ‘ˆ ADD THIS

fetch("data/mangrove_canopy_height_classes.geojson")
  .then(response => response.json())
  .then(data => {
    mangroveLayer.addData(data);
  });


  // ====================================================
  // LAYER CONTROL
  // ====================================================
  var baseMaps = {
    "OpenStreetMap": osm
  };

  var overlayMaps = {
    "Canopy Height (GEE Raster)": canopyHeight,
    "Mangrove Height Classes (Vector)": mangroveLayer
  };

  L.control.layers(baseMaps, overlayMaps, {
    collapsed: false
  }).addTo(map);

  // ====================================================
  // LEGEND
  // ====================================================
  var legend = L.control({ position: 'bottomleft' });

  legend.onAdd = function () {
  var div = L.DomUtil.create('div', 'legend');
  div.innerHTML += '<strong>Mangrove Height (m)</strong><br>';
  div.innerHTML += '<i style="background:#2c7bb6"></i> < 5 m<br>';
  div.innerHTML += '<i style="background:#1a9641"></i> 5 â€“ 10 m<br>';
  div.innerHTML += '<i style="background:#ffff33"></i> 10 â€“ 20 m<br>';
  div.innerHTML += '<i style="background:#d7191c"></i> > 20 m<br>';
  return div;
};
  
.legend i {
  border-radius: 3px;
}


  legend.addTo(map);
</script>

</body>
</html>
